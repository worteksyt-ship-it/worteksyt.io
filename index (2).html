<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FanDrot | Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00d9ff;
            --primary-dark: #00a6cc;
            --accent: #ff3366;
            --admin: #9d4edd;
            --moderator: #4cc9f0;
            --dark: #0a0f1c;
            --dark-2: #121827;
            --dark-3: #1a2236;
            --light: #ffffff;
            --gray: #8a9bb8;
            --danger: #ff4757;
            --success: #2ed573;
            --warning: #ffaa00;
            --gradient: linear-gradient(135deg, #00d9ff 0%, #0099ff 100%);
            --gradient-accent: linear-gradient(135deg, #ff3366 0%, #ff6b9d 100%);
            --gradient-admin: linear-gradient(135deg, #9d4edd 0%, #560bad 100%);
            --gradient-moderator: linear-gradient(135deg, #4cc9f0 0%, #4361ee 100%);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--dark);
            color: var(--light);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Animated Background */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(circle at 10% 20%, rgba(0, 217, 255, 0.05) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(157, 78, 221, 0.05) 0%, transparent 40%),
                linear-gradient(135deg, var(--dark) 0%, #0c1220 100%);
        }

        .floating-dots {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .dot {
            position: absolute;
            width: 4px;
            height: 4px;
            background: var(--primary);
            border-radius: 50%;
            opacity: 0.3;
            animation: float 15s infinite linear;
        }

        @keyframes float {
            0% { transform: translateY(100vh) translateX(0); }
            100% { transform: translateY(-100px) translateX(100px); }
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            background: rgba(10, 15, 28, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 217, 255, 0.2);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            font-weight: 800;
            text-decoration: none;
            color: var(--light);
            letter-spacing: 1px;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 24px;
            text-shadow: 0 0 15px var(--primary);
        }

        .logo-text {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .nav-links {
            display: flex;
            gap: 35px;
        }

        .nav-link {
            color: var(--gray);
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
            padding: 5px 0;
        }

        .nav-link:hover {
            color: var(--primary);
        }

        .nav-link.active {
            color: var(--light);
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--gradient);
            border-radius: 2px;
        }

        .nav-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        /* Badges for roles */
        .role-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-admin {
            background: var(--gradient-admin);
            color: white;
        }

        .role-moderator {
            background: var(--gradient-moderator);
            color: white;
        }

        .role-user {
            background: rgba(255, 255, 255, 0.1);
            color: var(--gray);
        }

        /* Buttons */
        .btn {
            padding: 12px 28px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            font-size: 15px;
            font-family: 'Montserrat', sans-serif;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.2);
        }

        .btn-outline:hover {
            background: rgba(0, 217, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 0 30px rgba(0, 217, 255, 0.4);
        }

        .btn-primary {
            background: var(--gradient);
            color: var(--light);
            font-weight: 700;
            border: none;
            box-shadow: 0 5px 20px rgba(0, 153, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 153, 255, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff4757 0%, #ff6b81 100%);
            color: var(--light);
            font-weight: 700;
            border: none;
            box-shadow: 0 5px 20px rgba(255, 71, 87, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.4);
        }

        .btn-admin {
            background: var(--gradient-admin);
            color: var(--light);
            font-weight: 700;
            border: none;
            box-shadow: 0 5px 20px rgba(157, 78, 221, 0.3);
        }

        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(157, 78, 221, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffaa00 0%, #ffcc00 100%);
            color: var(--dark);
            font-weight: 700;
            border: none;
            box-shadow: 0 5px 20px rgba(255, 170, 0, 0.3);
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 170, 0, 0.4);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-very-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        /* Main Content */
        .main-content {
            display: none;
            min-height: 100vh;
            padding-top: 100px;
        }

        .main-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Hero Section */
        .hero {
            padding: 200px 0 120px;
            text-align: center;
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            background: radial-gradient(circle, rgba(0, 217, 255, 0.1) 0%, transparent 70%);
            z-index: -1;
        }

        .hero-tag {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.3);
            padding: 10px 22px;
            border-radius: 50px;
            margin-bottom: 40px;
            color: var(--primary);
            font-weight: 500;
            font-size: 14px;
            letter-spacing: 1px;
        }

        .hero h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 56px;
            font-weight: 800;
            line-height: 1.1;
            margin-bottom: 25px;
            background: linear-gradient(45deg, var(--light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -0.5px;
        }

        .hero p {
            font-size: 18px;
            color: var(--gray);
            margin-bottom: 45px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.8;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        /* Profile Page */
        .profile-section {
            max-width: 800px;
            margin: 0 auto;
            padding: 50px 0;
        }

        .section-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 40px;
            color: var(--light);
            text-align: center;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 35px;
            margin-bottom: 50px;
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.8), rgba(18, 24, 39, 0.8));
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .avatar-container {
            position: relative;
        }

        .avatar {
            width: 140px;
            height: 140px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid transparent;
            background: linear-gradient(var(--dark-3), var(--dark-3)) padding-box,
                        var(--gradient) border-box;
            box-shadow: 0 10px 30px rgba(0, 217, 255, 0.2);
        }

        .avatar-upload {
            position: absolute;
            bottom: 10px;
            right: 10px;
            background: var(--gradient);
            color: var(--light);
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 2px solid var(--dark-3);
            font-size: 16px;
            transition: all 0.3s;
        }

        .avatar-upload:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(0, 217, 255, 0.5);
        }

        .profile-info h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            margin-bottom: 10px;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .profile-info p {
            color: var(--gray);
            margin-bottom: 15px;
            font-size: 16px;
        }

        .username {
            display: inline-block;
            background: rgba(0, 217, 255, 0.15);
            color: var(--primary);
            padding: 8px 20px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 15px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 0.5px;
        }

        .profile-form {
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.8), rgba(18, 24, 39, 0.8));
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(0, 217, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            margin-bottom: 25px;
        }

        .profile-form h3 {
            font-family: 'Montserrat', sans-serif;
            font-size: 24px;
            margin-bottom: 30px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--light);
            font-size: 15px;
            font-family: 'Montserrat', sans-serif;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--light);
            font-size: 15px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
        }

        /* Security Settings */
        .security-form {
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.8), rgba(18, 24, 39, 0.8));
            padding: 40px;
            border-radius: 20px;
            border: 1px solid rgba(255, 71, 87, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
        }

        .security-form h3 {
            color: var(--accent);
        }

        .password-strength {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin-top: 10px;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            border-radius: 3px;
            transition: all 0.3s;
        }

        .strength-weak {
            background: var(--danger);
            width: 33%;
        }

        .strength-medium {
            background: var(--warning);
            width: 66%;
        }

        .strength-strong {
            background: var(--success);
            width: 100%;
        }

        .password-requirements {
            color: var(--gray);
            font-size: 13px;
            margin-top: 10px;
        }

        .password-requirements ul {
            padding-left: 20px;
            margin-top: 5px;
        }

        .password-requirements li {
            margin-bottom: 5px;
        }

        .password-requirements .valid {
            color: var(--success);
        }

        .password-requirements .invalid {
            color: var(--gray);
        }

        /* Forum Page */
        .forum-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 50px 0;
        }

        .forum-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
        }

        .forum-header h1 {
            font-family: 'Montserrat', sans-serif;
            font-size: 42px;
            color: var(--light);
        }

        .forum-header h1 span {
            background: var(--gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .forum-container {
            display: flex;
            gap: 25px;
        }

        /* Chat Sidebar */
        .chat-sidebar {
            width: 300px;
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.8), rgba(18, 24, 39, 0.8));
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(0, 217, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            height: fit-content;
        }

        .chat-sidebar h3 {
            margin-bottom: 20px;
            font-family: 'Montserrat', sans-serif;
            font-size: 20px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rules-list {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 30px;
        }

        .rules-list p {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rules-list i {
            color: var(--primary);
            font-size: 12px;
        }

        .anti-spam-info {
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.2);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
        }

        .anti-spam-info h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        /* Chat Main */
        .chat-main {
            flex: 1;
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.8), rgba(18, 24, 39, 0.8));
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(0, 217, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            max-height: 500px;
            margin-bottom: 30px;
            padding-right: 15px;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .message {
            display: flex;
            gap: 18px;
            margin-bottom: 25px;
            padding: 20px;
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            animation: slideIn 0.3s ease;
            position: relative;
        }

        .message:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(0, 217, 255, 0.1);
        }

        .message.deleted {
            opacity: 0.5;
            background: rgba(255, 71, 87, 0.05);
            border-color: rgba(255, 71, 87, 0.2);
        }

        .message.deleted .message-text {
            color: var(--gray);
            font-style: italic;
        }

        .deleted-label {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 71, 87, 0.2);
            color: var(--danger);
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid transparent;
            background: linear-gradient(var(--dark-3), var(--dark-3)) padding-box,
                        var(--gradient) border-box;
        }

        .message-content {
            flex: 1;
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .message-sender {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: var(--primary);
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-time {
            color: var(--gray);
            font-size: 13px;
            font-family: 'Montserrat', sans-serif;
        }

        .message-text {
            color: var(--light);
            line-height: 1.7;
            font-size: 15px;
        }

        .message-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-attachments {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .attachment {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(0, 217, 255, 0.1);
            padding: 10px 16px;
            border-radius: 10px;
            color: var(--primary);
            font-size: 14px;
            cursor: pointer;
            border: 1px solid rgba(0, 217, 255, 0.2);
            transition: all 0.3s;
        }

        .attachment:hover {
            background: rgba(0, 217, 255, 0.2);
            transform: translateY(-2px);
        }

        /* Message Form */
        .message-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message-input {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 18px;
            color: var(--light);
            font-size: 15px;
            resize: none;
            min-height: 100px;
            font-family: 'Poppins', sans-serif;
            transition: all 0.3s;
        }

        .message-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.2);
        }

        .form-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .file-upload {
            display: flex;
            gap: 12px;
        }

        .file-label {
            background: rgba(0, 217, 255, 0.1);
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            color: var(--primary);
            font-weight: 500;
            font-size: 14px;
            transition: all 0.3s;
            border: 1px solid rgba(0, 217, 255, 0.2);
        }

        .file-label:hover {
            background: rgba(0, 217, 255, 0.2);
            transform: translateY(-2px);
        }

        .file-input {
            display: none;
        }

        .spam-warning {
            color: var(--accent);
            font-size: 14px;
            display: none;
            align-items: center;
            gap: 10px;
            background: rgba(255, 51, 102, 0.1);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 51, 102, 0.2);
        }

        .spam-warning.active {
            display: flex;
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
        }

        .tab {
            background: none;
            border: none;
            color: var(--gray);
            font-size: 16px;
            font-weight: 600;
            padding: 10px 0;
            cursor: pointer;
            position: relative;
            transition: color 0.3s;
            font-family: 'Montserrat', sans-serif;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--light);
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -17px;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient);
            border-radius: 3px;
        }

        /* Admin Panel */
        .admin-panel {
            max-width: 1200px;
            margin: 0 auto;
            padding: 50px 0;
        }

        .admin-section {
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.8), rgba(18, 24, 39, 0.8));
            border-radius: 20px;
            padding: 40px;
            border: 1px solid rgba(157, 78, 221, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.2);
            margin-bottom: 30px;
        }

        .admin-section h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 28px;
            margin-bottom: 30px;
            color: var(--admin);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--admin);
        }

        .stat-number {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px;
            font-weight: 700;
            color: var(--admin);
            margin-bottom: 10px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .users-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }

        .user-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }

        .user-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-info h4 {
            font-family: 'Montserrat', sans-serif;
            font-size: 18px;
            color: var(--light);
            margin-bottom: 5px;
        }

        .user-info p {
            color: var(--gray);
            font-size: 13px;
        }

        .user-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .role-select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--light);
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 14px;
            width: 100%;
            margin-bottom: 10px;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 15, 28, 0.95);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.95), rgba(18, 24, 39, 0.95));
            border-radius: 20px;
            width: 100%;
            max-width: 480px;
            padding: 50px;
            border: 1px solid rgba(0, 217, 255, 0.3);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            position: relative;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .modal-header h2 {
            font-family: 'Montserrat', sans-serif;
            font-size: 32px;
            margin-bottom: 15px;
            color: var(--light);
        }

        .modal-header p {
            color: var(--gray);
            font-size: 16px;
        }

        .form-footer {
            text-align: center;
            margin-top: 25px;
            color: var(--gray);
        }

        .form-footer a {
            color: var(--primary);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
        }

        .form-footer a:hover {
            color: var(--light);
        }

        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 217, 255, 0.1);
            border: 1px solid rgba(0, 217, 255, 0.2);
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .close-modal:hover {
            background: var(--primary);
            color: var(--light);
            transform: rotate(90deg);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 90px;
            right: 30px;
            background: linear-gradient(135deg, rgba(26, 34, 54, 0.95), rgba(18, 24, 39, 0.95));
            padding: 20px 25px;
            border-radius: 15px;
            z-index: 1000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 217, 255, 0.2);
            animation: slideInRight 0.3s ease, fadeOut 0.3s ease 2.7s;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 4px solid var(--primary);
        }

        .notification-icon {
            color: var(--primary);
            font-size: 22px;
        }

        .notification-content h4 {
            color: var(--light);
            margin-bottom: 5px;
            font-family: 'Montserrat', sans-serif;
        }

        .notification-content p {
            color: var(--gray);
            font-size: 14px;
        }

        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }

        /* Utility */
        .hidden {
            display: none !important;
        }

        .mt-4 {
            margin-top: 25px;
        }

        .text-center {
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 1024px) {
            .forum-container {
                flex-direction: column;
            }
            
            .chat-sidebar {
                width: 100%;
            }
            
            .hero h1 {
                font-size: 48px;
            }
            
            .admin-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            
            .hero {
                padding: 160px 0 80px;
            }
            
            .hero h1 {
                font-size: 40px;
            }
            
            .hero p {
                font-size: 16px;
            }
            
            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .form-actions {
                flex-direction: column;
                gap: 20px;
                align-items: flex-start;
            }
            
            .file-upload {
                flex-wrap: wrap;
            }
            
            .section-title {
                font-size: 30px;
            }
            
            .admin-stats {
                grid-template-columns: 1fr;
            }
            
            .users-list {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .hero h1 {
                font-size: 32px;
            }
            
            .modal-content {
                padding: 30px 20px;
            }
            
            .profile-header {
                padding: 30px 20px;
            }
            
            .profile-form {
                padding: 30px 20px;
            }
            
            .admin-section {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="floating-dots" id="floatingDots"></div>
    </div>

    <!-- Header -->
    <header>
        <div class="container nav-container">
            <a href="#" class="logo">
                <i class="fas fa-shield-alt logo-icon"></i>
                <span class="logo-text">FanDrot</span>
            </a>
            <div class="nav-links">
                <a href="#" class="nav-link active" data-section="home">Home</a>
                <a href="#" class="nav-link" data-section="forum">Forum</a>
                <a href="#" class="nav-link" data-section="profile">Profile</a>
                <a href="#" class="nav-link" id="adminPanelLink" style="display: none;">
                    <i class="fas fa-crown"></i> Admin Panel
                </a>
            </div>
            <div class="nav-actions">
                <button class="btn btn-outline btn-small" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Log in
                </button>
                <button class="btn btn-primary btn-small" id="registerBtn">
                    <i class="fas fa-user-plus"></i> Sign Up
                </button>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section id="home" class="main-content active">
        <div class="container">
            <div class="hero">
                <div class="hero-tag">
                    <i class="fas fa-bolt"></i>
                    <span>SECURE ENCRYPTED PLATFORM</span>
                </div>
                <h1>Connect. Share. <span>Encrypted.</span></h1>
                <p>FanDrot provides a secure, encrypted environment for communities to connect, share files, and communicate with complete privacy. Your data stays protected with military-grade encryption.</p>
                <div class="hero-buttons">
                    <button class="btn btn-primary" id="heroRegisterBtn">
                        <i class="fas fa-rocket"></i> Get Started Free
                    </button>
                    <button class="btn btn-outline" id="learnMoreBtn">
                        <i class="fas fa-play-circle"></i> Watch Demo
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Profile Section -->
    <section id="profile" class="main-content">
        <div class="container">
            <div class="profile-section">
                <h1 class="section-title">Your Profile</h1>
                
                <div class="profile-header">
                    <div class="avatar-container">
                        <img src="https://ui-avatars.com/api/?name=FanDrot+User&background=0099ff&color=ffffff&size=150&bold=true&font-size=0.5" alt="Avatar" class="avatar" id="avatarImg">
                        <div class="avatar-upload" id="avatarUploadBtn">
                            <i class="fas fa-camera"></i>
                        </div>
                        <input type="file" id="avatarInput" class="hidden" accept="image/*">
                    </div>
                    <div class="profile-info">
                        <h2 id="displayName">FanDrot User</h2>
                        <div id="roleBadge" class="role-badge role-user" style="margin-bottom: 15px;">
                            <i class="fas fa-user"></i> User
                        </div>
                        <p><i class="fas fa-calendar-alt"></i> Member since <span id="joinDate">January 2024</span></p>
                        <p><i class="fas fa-envelope"></i> <span id="userEmail">user@fandrot.com</span></p>
                        <div class="username" id="usernameDisplay">@fandrot_user</div>
                    </div>
                </div>
                
                <!-- Profile Information Form -->
                <div class="profile-form">
                    <h3><i class="fas fa-user-edit"></i> Edit Profile Information</h3>
                    <div class="form-group">
                        <label for="nickname">Display Name</label>
                        <input type="text" id="nickname" class="form-control" placeholder="Enter your display name" value="FanDrot User">
                    </div>
                    <div class="form-group">
                        <label>Username (Permanent)</label>
                        <input type="text" class="form-control" id="permanentUsername" value="@fandrot_user" disabled>
                        <small style="color: var(--gray); margin-top: 5px; display: block;">Username cannot be changed after registration</small>
                    </div>
                    <div class="form-group">
                        <label for="userBio">Bio</label>
                        <textarea id="userBio" class="form-control" rows="3" placeholder="Tell us about yourself..."></textarea>
                    </div>
                    <button class="btn btn-primary" id="saveProfileBtn">
                        <i class="fas fa-save"></i> Save Changes
                    </button>
                </div>

                <!-- Change Email Form -->
                <div class="profile-form security-form">
                    <h3><i class="fas fa-envelope"></i> Change Email Address</h3>
                    <div class="form-group">
                        <label for="currentPasswordForEmail">Current Password</label>
                        <input type="password" id="currentPasswordForEmail" class="form-control" placeholder="Enter your current password">
                    </div>
                    <div class="form-group">
                        <label for="newEmail">New Email Address</label>
                        <input type="email" id="newEmail" class="form-control" placeholder="Enter new email address">
                    </div>
                    <div class="form-group">
                        <label for="confirmNewEmail">Confirm New Email</label>
                        <input type="email" id="confirmNewEmail" class="form-control" placeholder="Confirm new email address">
                    </div>
                    <button class="btn btn-primary" id="changeEmailBtn">
                        <i class="fas fa-envelope"></i> Update Email
                    </button>
                </div>

                <!-- Change Password Form -->
                <div class="profile-form security-form">
                    <h3><i class="fas fa-lock"></i> Change Password</h3>
                    <div class="form-group">
                        <label for="currentPassword">Current Password</label>
                        <input type="password" id="currentPassword" class="form-control" placeholder="Enter your current password">
                    </div>
                    <div class="form-group">
                        <label for="newPassword">New Password</label>
                        <input type="password" id="newPassword" class="form-control" placeholder="Enter new password">
                        <div class="password-strength" id="passwordStrength">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <div class="password-requirements" id="passwordRequirements">
                            <p>Password must contain:</p>
                            <ul>
                                <li id="reqLength" class="invalid">At least 8 characters</li>
                                <li id="reqUppercase" class="invalid">One uppercase letter</li>
                                <li id="reqLowercase" class="invalid">One lowercase letter</li>
                                <li id="reqNumber" class="invalid">One number</li>
                            </ul>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="confirmNewPassword">Confirm New Password</label>
                        <input type="password" id="confirmNewPassword" class="form-control" placeholder="Confirm new password">
                    </div>
                    <button class="btn btn-primary" id="changePasswordBtn">
                        <i class="fas fa-key"></i> Change Password
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Forum Section -->
    <section id="forum" class="main-content">
        <div class="container">
            <div class="forum-section">
                <div class="forum-header">
                    <h1>Community <span>Forum</span></h1>
                    <div>
                        <button class="btn btn-accent" id="newTopicBtn">
                            <i class="fas fa-plus-circle"></i> New Topic
                        </button>
                    </div>
                </div>
                
                <div class="tabs">
                    <button class="tab active" data-tab="general">
                        <i class="fas fa-comments"></i> General
                    </button>
                    <button class="tab" data-tab="tech">
                        <i class="fas fa-code"></i> Tech Talk
                    </button>
                    <button class="tab" data-tab="support">
                        <i class="fas fa-life-ring"></i> Support
                    </button>
                    <button class="tab" data-tab="offtopic">
                        <i class="fas fa-gamepad"></i> Off-Topic
                    </button>
                </div>
                
                <div class="forum-container">
                    <div class="chat-sidebar">
                        <h3><i class="fas fa-gavel"></i> Community Rules</h3>
                        <div class="rules-list">
                            <p><i class="fas fa-check-circle"></i> Be respectful to all members</p>
                            <p><i class="fas fa-check-circle"></i> No hate speech or harassment</p>
                            <p><i class="fas fa-check-circle"></i> Keep conversations on-topic</p>
                            <p><i class="fas fa-check-circle"></i> No spam or self-promotion</p>
                            <p><i class="fas fa-check-circle"></i> Respect everyone's privacy</p>
                        </div>
                        
                        <div class="anti-spam-info">
                            <h4><i class="fas fa-shield-alt"></i> Anti-Spam System</h4>
                            <p style="color: var(--gray); font-size: 13px; line-height: 1.6;">
                                • 5 second cooldown between messages<br>
                                • Maximum 3 messages per 10 seconds<br>
                                • Automated spam detection active<br>
                                • File size limit: 10MB
                            </p>
                        </div>
                    </div>
                    
                    <div class="chat-main">
                        <div class="messages-container" id="messagesContainer">
                            <!-- Messages will be added here by JavaScript -->
                        </div>
                        
                        <form class="message-form" id="messageForm">
                            <textarea class="message-input" id="messageInput" placeholder="Share your thoughts... (Anti-spam: 5 second cooldown between messages)"></textarea>
                            <div class="spam-warning" id="spamWarning">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span id="warningText">Please wait before sending another message</span>
                            </div>
                            <div class="form-actions">
                                <div class="file-upload">
                                    <label class="file-label" for="fileInput">
                                        <i class="fas fa-paperclip"></i> Attach File
                                    </label>
                                    <input type="file" id="fileInput" class="file-input" multiple>
                                    <label class="file-label" for="imageInput">
                                        <i class="fas fa-image"></i> Image
                                    </label>
                                    <input type="file" id="imageInput" class="file-input" accept="image/*">
                                    <label class="file-label" for="videoInput">
                                        <i class="fas fa-video"></i> Video
                                    </label>
                                    <input type="file" id="videoInput" class="file-input" accept="video/*">
                                </div>
                                <button type="submit" class="btn btn-primary" id="sendBtn">
                                    <i class="fas fa-paper-plane"></i> Send Message
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Admin Panel Section -->
    <section id="adminPanel" class="main-content">
        <div class="container admin-panel">
            <div class="section-title">
                <i class="fas fa-crown"></i> Administration Panel
            </div>
            
            <div class="admin-stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalUsers">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalMessages">0</div>
                    <div class="stat-label">Total Messages</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="adminCount">0</div>
                    <div class="stat-label">Administrators</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="moderatorCount">0</div>
                    <div class="stat-label">Moderators</div>
                </div>
            </div>
            
            <div class="admin-section">
                <h2><i class="fas fa-users-cog"></i> User Management</h2>
                <div class="users-list" id="usersList">
                    <!-- Users will be loaded here -->
                </div>
            </div>
            
            <div class="admin-section">
                <h2><i class="fas fa-trash-alt"></i> Deleted Messages</h2>
                <div class="messages-container" id="deletedMessages">
                    <!-- Deleted messages will be loaded here -->
                </div>
            </div>
        </div>
    </section>

    <!-- Modals -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <button class="close-modal" id="closeLoginModal">&times;</button>
            <div class="modal-header">
                <h2><i class="fas fa-sign-in-alt"></i> Welcome Back</h2>
                <p>Sign in to your FanDrot account</p>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">Username</label>
                    <input type="text" id="loginUsername" class="form-control" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="Enter your password" required>
                </div>
                <div class="form-group" style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="rememberMe" style="width: auto;">
                    <label for="rememberMe" style="margin-bottom: 0;">Remember me</label>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-lock"></i> Sign In
                </button>
            </form>
            <div class="form-footer">
                <p>Don't have an account? <a href="#" id="switchToRegister">Create one now</a></p>
                <p style="margin-top: 10px; font-size: 12px; color: var(--gray);">
                    Demo Admin: admin / password123<br>
                    Demo Moderator: moderator / password123
                </p>
            </div>
        </div>
    </div>

    <div class="modal" id="registerModal">
        <div class="modal-content">
            <button class="close-modal" id="closeRegisterModal">&times;</button>
            <div class="modal-header">
                <h2><i class="fas fa-user-plus"></i> Join FanDrot</h2>
                <p>Create your secure account</p>
            </div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerUsername">Username (Permanent)</label>
                    <input type="text" id="registerUsername" class="form-control" placeholder="Choose a username" required>
                    <small style="color: var(--gray); margin-top: 5px; display: block;">This username cannot be changed later</small>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email Address</label>
                    <input type="email" id="registerEmail" class="form-control" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="Create a password" required>
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">Confirm Password</label>
                    <input type="password" id="registerConfirmPassword" class="form-control" placeholder="Confirm your password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-user-check"></i> Create Account
                </button>
            </form>
            <div class="form-footer">
                <p>Already have an account? <a href="#" id="switchToLogin">Sign in here</a></p>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <button class="close-modal" id="closeDeleteModal">&times;</button>
            <div class="modal-header">
                <h2><i class="fas fa-trash-alt"></i> Delete Message</h2>
                <p>Are you sure you want to delete this message?</p>
            </div>
            <div id="deleteMessageContent" style="background: rgba(255, 71, 87, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 30px; border: 1px solid rgba(255, 71, 87, 0.2);">
                <!-- Message content will be inserted here -->
            </div>
            <div style="display: flex; gap: 15px;">
                <button class="btn btn-outline" id="cancelDeleteBtn" style="flex: 1;">Cancel</button>
                <button class="btn btn-danger" id="confirmDeleteBtn" style="flex: 1;">
                    <i class="fas fa-trash"></i> Delete Message
                </button>
            </div>
        </div>
    </div>

    <script>
        // State Management
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('fandrot_users')) || [];
        let messages = JSON.parse(localStorage.getItem('fandrot_messages')) || [];
        let deletedMessages = JSON.parse(localStorage.getItem('fandrot_deleted_messages')) || [];
        let antiSpam = {
            lastMessageTime: 0,
            messageCount: 0,
            resetTime: Date.now(),
            cooldown: 5000,
            floodWindow: 10000,
            maxMessages: 3
        };

        // Default admin and moderator accounts
        const DEFAULT_USERS = [
            {
                id: 'admin_1',
                username: 'admin',
                email: 'admin@fandrot.com',
                password: 'password123',
                nickname: 'System Administrator',
                bio: 'Head administrator of FanDrot',
                avatar: 'https://ui-avatars.com/api/?name=Admin&background=9d4edd&color=ffffff&size=150&bold=true',
                joinDate: new Date().toISOString(),
                role: 'admin',
                permissions: ['delete_messages', 'manage_users', 'assign_roles', 'view_admin_panel']
            },
            {
                id: 'moderator_1',
                username: 'moderator',
                email: 'moderator@fandrot.com',
                password: 'password123',
                nickname: 'Community Moderator',
                bio: 'FanDrot community moderator',
                avatar: 'https://ui-avatars.com/api/?name=Moderator&background=4cc9f0&color=ffffff&size=150&bold=true',
                joinDate: new Date().toISOString(),
                role: 'moderator',
                permissions: ['delete_messages']
            }
        ];

        // Initialize default users if not exist
        if (users.length === 0) {
            users = [...DEFAULT_USERS];
            localStorage.setItem('fandrot_users', JSON.stringify(users));
        }

        // DOM Elements
        const homeSection = document.getElementById('home');
        const profileSection = document.getElementById('profile');
        const forumSection = document.getElementById('forum');
        const adminPanelSection = document.getElementById('adminPanel');
        const adminPanelLink = document.getElementById('adminPanelLink');
        const loginModal = document.getElementById('loginModal');
        const registerModal = document.getElementById('registerModal');
        const deleteModal = document.getElementById('deleteModal');
        const loginBtn = document.getElementById('loginBtn');
        const registerBtn = document.getElementById('registerBtn');
        const heroRegisterBtn = document.getElementById('heroRegisterBtn');
        const learnMoreBtn = document.getElementById('learnMoreBtn');
        const closeLoginModal = document.getElementById('closeLoginModal');
        const closeRegisterModal = document.getElementById('closeRegisterModal');
        const closeDeleteModal = document.getElementById('closeDeleteModal');
        const switchToRegister = document.getElementById('switchToRegister');
        const switchToLogin = document.getElementById('switchToLogin');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const avatarUploadBtn = document.getElementById('avatarUploadBtn');
        const avatarInput = document.getElementById('avatarInput');
        const avatarImg = document.getElementById('avatarImg');
        const saveProfileBtn = document.getElementById('saveProfileBtn');
        const nicknameInput = document.getElementById('nickname');
        const userBio = document.getElementById('userBio');
        const usernameDisplay = document.getElementById('usernameDisplay');
        const displayName = document.getElementById('displayName');
        const joinDate = document.getElementById('joinDate');
        const userEmail = document.getElementById('userEmail');
        const permanentUsername = document.getElementById('permanentUsername');
        const roleBadge = document.getElementById('roleBadge');
        const messageForm = document.getElementById('messageForm');
        const messageInput = document.getElementById('messageInput');
        const messagesContainer = document.getElementById('messagesContainer');
        const deletedMessagesContainer = document.getElementById('deletedMessages');
        const tabs = document.querySelectorAll('.tab');
        const fileInput = document.getElementById('fileInput');
        const imageInput = document.getElementById('imageInput');
        const videoInput = document.getElementById('videoInput');
        const spamWarning = document.getElementById('spamWarning');
        const warningText = document.getElementById('warningText');
        const sendBtn = document.getElementById('sendBtn');
        const newTopicBtn = document.getElementById('newTopicBtn');
        const navLinks = document.querySelectorAll('.nav-link');
        const deleteMessageContent = document.getElementById('deleteMessageContent');
        
        // New profile elements
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const changeEmailBtn = document.getElementById('changeEmailBtn');
        const currentPassword = document.getElementById('currentPassword');
        const newPassword = document.getElementById('newPassword');
        const confirmNewPassword = document.getElementById('confirmNewPassword');
        const currentPasswordForEmail = document.getElementById('currentPasswordForEmail');
        const newEmail = document.getElementById('newEmail');
        const confirmNewEmail = document.getElementById('confirmNewEmail');
        const passwordStrength = document.getElementById('passwordStrength');
        const strengthBar = document.getElementById('strengthBar');
        const passwordRequirements = document.getElementById('passwordRequirements');
        const reqLength = document.getElementById('reqLength');
        const reqUppercase = document.getElementById('reqUppercase');
        const reqLowercase = document.getElementById('reqLowercase');
        const reqNumber = document.getElementById('reqNumber');
        
        // Admin panel elements
        const totalUsers = document.getElementById('totalUsers');
        const totalMessages = document.getElementById('totalMessages');
        const adminCount = document.getElementById('adminCount');
        const moderatorCount = document.getElementById('moderatorCount');
        const usersList = document.getElementById('usersList');
        
        let messageToDelete = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Create floating dots
            createFloatingDots();
            
            // Check if user is already logged in
            const savedUser = localStorage.getItem('fandrot_currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUIForUser();
                showSection('forum');
            }
            
            // Load messages
            loadMessages();
            
            // Add sample messages if empty
            if (messages.length === 0) {
                addSampleMessages();
            }
            
            // Set default join date
            const now = new Date();
            joinDate.textContent = now.toLocaleDateString('en-US', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Initialize navigation
            setupNavigation();
            
            // Setup all button listeners
            setupAllButtonListeners();
            
            // Show welcome message
            setTimeout(() => {
                if (!currentUser) {
                    showNotification('Welcome to FanDrot', 'Join our encrypted community today!');
                }
            }, 1000);
        });

        // Create floating dots for background
        function createFloatingDots() {
            const container = document.getElementById('floatingDots');
            for (let i = 0; i < 50; i++) {
                const dot = document.createElement('div');
                dot.className = 'dot';
                dot.style.left = `${Math.random() * 100}%`;
                dot.style.top = `${Math.random() * 100}%`;
                dot.style.animationDelay = `${Math.random() * 20}s`;
                dot.style.animationDuration = `${15 + Math.random() * 20}s`;
                container.appendChild(dot);
            }
        }

        // Setup all button listeners
        function setupAllButtonListeners() {
            // Modal controls
            loginBtn.addEventListener('click', () => showModal('login'));
            registerBtn.addEventListener('click', () => showModal('register'));
            heroRegisterBtn.addEventListener('click', () => showModal('register'));
            learnMoreBtn.addEventListener('click', () => {
                showNotification('Demo', 'Check out our features and how FanDrot protects your privacy.');
            });
            
            // Close modals
            closeLoginModal.addEventListener('click', () => hideModal('login'));
            closeRegisterModal.addEventListener('click', () => hideModal('register'));
            closeDeleteModal.addEventListener('click', () => hideModal('delete'));
            cancelDeleteBtn.addEventListener('click', () => hideModal('delete'));
            
            // Switch between login/register
            switchToRegister.addEventListener('click', (e) => {
                e.preventDefault();
                hideModal('login');
                showModal('register');
            });
            
            switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                hideModal('register');
                showModal('login');
            });
            
            // New topic button
            newTopicBtn.addEventListener('click', () => {
                if (!currentUser) {
                    showModal('login');
                    return;
                }
                showNotification('New Topic', 'Start a new discussion in the forum.');
            });
            
            // Form submissions
            loginForm.addEventListener('submit', handleLogin);
            registerForm.addEventListener('submit', handleRegister);
            messageForm.addEventListener('submit', handleMessageSubmit);
            confirmDeleteBtn.addEventListener('click', handleDeleteMessage);
            
            // Profile actions
            avatarUploadBtn.addEventListener('click', () => avatarInput.click());
            avatarInput.addEventListener('change', handleAvatarUpload);
            saveProfileBtn.addEventListener('click', handleSaveProfile);
            
            // Security actions
            changePasswordBtn.addEventListener('click', handleChangePassword);
            changeEmailBtn.addEventListener('click', handleChangeEmail);
            
            // Password strength indicator
            newPassword.addEventListener('input', checkPasswordStrength);
            
            // File uploads
            fileInput.addEventListener('change', handleFileUpload);
            imageInput.addEventListener('change', handleFileUpload);
            videoInput.addEventListener('change', handleFileUpload);
            
            // Tabs
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    loadMessages(tabName);
                });
            });
            
            // Real-time message input monitoring
            messageInput.addEventListener('input', checkSpamStatus);
        }

        // Show/hide modal
        function showModal(modal) {
            if (modal === 'login') {
                loginModal.classList.add('active');
            } else if (modal === 'register') {
                registerModal.classList.add('active');
            } else if (modal === 'delete') {
                deleteModal.classList.add('active');
            }
        }

        function hideModal(modal) {
            if (modal === 'login') {
                loginModal.classList.remove('active');
            } else if (modal === 'register') {
                registerModal.classList.remove('active');
            } else if (modal === 'delete') {
                deleteModal.classList.remove('active');
                messageToDelete = null;
            }
        }

        // Login handler
        function handleLogin(e) {
            e.preventDefault();
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                currentUser = user;
                localStorage.setItem('fandrot_currentUser', JSON.stringify(user));
                updateUIForUser();
                hideModal('login');
                showSection('forum');
                showNotification(`Welcome back, ${user.nickname || user.username}!`, `You have ${user.role} privileges.`);
            } else {
                showNotification('Login failed', 'Invalid username or password', 'error');
            }
        }

        // Register handler
        function handleRegister(e) {
            e.preventDefault();
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('registerConfirmPassword').value;
            
            // Validation
            if (password !== confirmPassword) {
                showNotification('Registration failed', 'Passwords do not match', 'error');
                return;
            }
            
            if (password.length < 6) {
                showNotification('Registration failed', 'Password must be at least 6 characters', 'error');
                return;
            }
            
            if (!username.match(/^[a-zA-Z0-9_]{3,20}$/)) {
                showNotification('Registration failed', 'Username: 3-20 characters, letters, numbers, underscores only', 'error');
                return;
            }
            
            const usernameExists = users.some(u => u.username === username);
            if (usernameExists) {
                showNotification('Registration failed', 'Username already taken', 'error');
                return;
            }
            
            const emailExists = users.some(u => u.email === email);
            if (emailExists) {
                showNotification('Registration failed', 'Email already registered', 'error');
                return;
            }
            
            // Create user
            const newUser = {
                id: generateId(),
                username: username,
                email: email,
                password: password,
                nickname: username,
                bio: '',
                avatar: `https://ui-avatars.com/api/?name=${encodeURIComponent(username)}&background=0099ff&color=ffffff&size=150&bold=true`,
                joinDate: new Date().toISOString(),
                role: 'user',
                permissions: []
            };
            
            users.push(newUser);
            localStorage.setItem('fandrot_users', JSON.stringify(users));
            
            currentUser = newUser;
            localStorage.setItem('fandrot_currentUser', JSON.stringify(newUser));
            
            updateUIForUser();
            hideModal('register');
            showSection('forum');
            showNotification('Account created!', 'Welcome to FanDrot community');
        }

        // Avatar upload
        function handleAvatarUpload(e) {
            const file = e.target.files[0];
            if (file) {
                if (file.size > 5 * 1024 * 1024) {
                    showNotification('Upload failed', 'Image must be less than 5MB', 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    avatarImg.src = event.target.result;
                    currentUser.avatar = event.target.result;
                    localStorage.setItem('fandrot_currentUser', JSON.stringify(currentUser));
                    updateUsersStorage();
                    showNotification('Avatar updated', 'Your profile image has been changed');
                };
                reader.readAsDataURL(file);
            }
        }

        // Save profile
        function handleSaveProfile() {
            const nickname = nicknameInput.value.trim();
            const bio = userBio.value.trim();
            
            if (nickname) {
                currentUser.nickname = nickname;
                currentUser.bio = bio;
                displayName.textContent = nickname;
                localStorage.setItem('fandrot_currentUser', JSON.stringify(currentUser));
                updateUsersStorage();
                showNotification('Profile saved', 'Your changes have been updated');
            }
        }

        // Change password handler
        function handleChangePassword() {
            const currentPass = currentPassword.value;
            const newPass = newPassword.value;
            const confirmPass = confirmNewPassword.value;
            
            if (!currentPass || !newPass || !confirmPass) {
                showNotification('Error', 'Please fill in all password fields', 'error');
                return;
            }
            
            // Check if current password is correct
            if (currentPass !== currentUser.password) {
                showNotification('Error', 'Current password is incorrect', 'error');
                return;
            }
            
            // Check if new passwords match
            if (newPass !== confirmPass) {
                showNotification('Error', 'New passwords do not match', 'error');
                return;
            }
            
            // Check password strength
            const strength = checkPasswordStrength(newPass, true);
            if (strength < 3) {
                showNotification('Error', 'New password is too weak. Please use a stronger password.', 'error');
                return;
            }
            
            // Update password
            currentUser.password = newPass;
            localStorage.setItem('fandrot_currentUser', JSON.stringify(currentUser));
            updateUsersStorage();
            
            // Clear fields
            currentPassword.value = '';
            newPassword.value = '';
            confirmNewPassword.value = '';
            
            showNotification('Password Changed', 'Your password has been updated successfully');
        }

        // Change email handler
        function handleChangeEmail() {
            const currentPass = currentPasswordForEmail.value;
            const email = newEmail.value;
            const confirmEmail = confirmNewEmail.value;
            
            if (!currentPass || !email || !confirmEmail) {
                showNotification('Error', 'Please fill in all email fields', 'error');
                return;
            }
            
            // Check if current password is correct
            if (currentPass !== currentUser.password) {
                showNotification('Error', 'Current password is incorrect', 'error');
                return;
            }
            
            // Check if emails match
            if (email !== confirmEmail) {
                showNotification('Error', 'Email addresses do not match', 'error');
                return;
            }
            
            // Validate email format
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Error', 'Please enter a valid email address', 'error');
                return;
            }
            
            // Check if email is already in use
            const emailExists = users.some(u => u.email === email && u.id !== currentUser.id);
            if (emailExists) {
                showNotification('Error', 'This email is already registered to another account', 'error');
                return;
            }
            
            // Update email
            currentUser.email = email;
            userEmail.textContent = email;
            localStorage.setItem('fandrot_currentUser', JSON.stringify(currentUser));
            updateUsersStorage();
            
            // Clear fields
            currentPasswordForEmail.value = '';
            newEmail.value = '';
            confirmNewEmail.value = '';
            
            showNotification('Email Changed', 'Your email address has been updated successfully');
        }

        // Check password strength
        function checkPasswordStrength(password, updateUI = false) {
            let strength = 0;
            
            // Check length
            if (password.length >= 8) {
                strength++;
                if (updateUI) reqLength.className = 'valid';
            } else if (updateUI) {
                reqLength.className = 'invalid';
            }
            
            // Check uppercase
            if (/[A-Z]/.test(password)) {
                strength++;
                if (updateUI) reqUppercase.className = 'valid';
            } else if (updateUI) {
                reqUppercase.className = 'invalid';
            }
            
            // Check lowercase
            if (/[a-z]/.test(password)) {
                strength++;
                if (updateUI) reqLowercase.className = 'valid';
            } else if (updateUI) {
                reqLowercase.className = 'invalid';
            }
            
            // Check number
            if (/[0-9]/.test(password)) {
                strength++;
                if (updateUI) reqNumber.className = 'valid';
            } else if (updateUI) {
                reqNumber.className = 'invalid';
            }
            
            // Update strength bar
            strengthBar.className = 'strength-bar';
            if (password.length > 0) {
                if (strength === 1) {
                    strengthBar.className = 'strength-bar strength-weak';
                } else if (strength === 2 || strength === 3) {
                    strengthBar.className = 'strength-bar strength-medium';
                } else if (strength === 4) {
                    strengthBar.className = 'strength-bar strength-strong';
                }
            }
            
            return strength;
        }

        // Message submission with anti-spam
        function handleMessageSubmit(e) {
            e.preventDefault();
            
            if (!currentUser) {
                showModal('login');
                return;
            }
            
            const spamCheck = checkSpam();
            if (!spamCheck.allowed) {
                showSpamWarning(spamCheck.reason, spamCheck.waitTime);
                return;
            }
            
            const text = messageInput.value.trim();
            if (!text && !filesToUpload.length) {
                showSpamWarning('Message cannot be empty', 0);
                return;
            }
            
            // Create message
            const message = {
                id: generateId(),
                userId: currentUser.id,
                username: currentUser.username,
                nickname: currentUser.nickname,
                avatar: currentUser.avatar,
                text: text,
                attachments: [...filesToUpload],
                timestamp: new Date().toISOString(),
                tab: document.querySelector('.tab.active').dataset.tab,
                deleted: false,
                deletedBy: null,
                deletedAt: null
            };
            
            messages.push(message);
            localStorage.setItem('fandrot_messages', JSON.stringify(messages));
            
            // Update anti-spam tracking
            antiSpam.lastMessageTime = Date.now();
            antiSpam.messageCount++;
            
            // Clear form
            messageInput.value = '';
            filesToUpload = [];
            hideSpamWarning();
            
            // Add to UI
            addMessageToUI(message);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Show sending animation
            sendBtn.innerHTML = '<i class="fas fa-lock"></i> Encrypting...';
            sendBtn.disabled = true;
            
            // Simulate encryption delay
            setTimeout(() => {
                sendBtn.innerHTML = '<i class="fas fa-paper-plane"></i> Send Message';
                sendBtn.disabled = false;
                showNotification('Message sent', 'Your encrypted message has been posted');
            }, 500);
        }

        // Check spam status
        function checkSpam() {
            const now = Date.now();
            
            // Reset counter every 10 seconds
            if (now - antiSpam.resetTime > antiSpam.floodWindow) {
                antiSpam.messageCount = 0;
                antiSpam.resetTime = now;
            }
            
            // Check cooldown
            if (now - antiSpam.lastMessageTime < antiSpam.cooldown) {
                return {
                    allowed: false,
                    reason: `Please wait ${Math.ceil((antiSpam.cooldown - (now - antiSpam.lastMessageTime)) / 1000)} seconds`,
                    waitTime: antiSpam.cooldown - (now - antiSpam.lastMessageTime)
                };
            }
            
            // Check flood
            if (antiSpam.messageCount >= antiSpam.maxMessages) {
                return {
                    allowed: false,
                    reason: "Too many messages. Please wait a moment.",
                    waitTime: antiSpam.floodWindow - (now - antiSpam.resetTime)
                };
            }
            
            return { allowed: true, reason: "", waitTime: 0 };
        }

        function checkSpamStatus() {
            const spamCheck = checkSpam();
            if (!spamCheck.allowed) {
                showSpamWarning(spamCheck.reason, spamCheck.waitTime);
            } else {
                hideSpamWarning();
            }
        }

        // File uploads
        let filesToUpload = [];
        
        function handleFileUpload(e) {
            const files = Array.from(e.target.files);
            const maxSize = 10 * 1024 * 1024;
            
            files.forEach(file => {
                if (file.size > maxSize) {
                    showNotification('Upload failed', `${file.name} exceeds 10MB limit`, 'error');
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    filesToUpload.push({
                        name: file.name,
                        type: file.type,
                        size: formatFileSize(file.size),
                        url: event.target.result
                    });
                    showNotification('File added', `${file.name} is ready to send`);
                };
                reader.readAsDataURL(file);
            });
        }

        // Navigation setup
        function setupNavigation() {
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const section = this.dataset.section;
                    if (section) {
                        showSection(section);
                        
                        navLinks.forEach(l => l.classList.remove('active'));
                        this.classList.add('active');
                    }
                });
            });
            
            // Admin panel link
            adminPanelLink.addEventListener('click', function(e) {
                e.preventDefault();
                if (currentUser && currentUser.role === 'admin') {
                    showSection('adminPanel');
                    loadAdminPanel();
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                }
            });
        }

        // Show section
        function showSection(section) {
            document.querySelectorAll('.main-content').forEach(sec => {
                sec.classList.remove('active');
            });
            
            if (section === 'home') {
                homeSection.classList.add('active');
            } else if (section === 'profile') {
                profileSection.classList.add('active');
                if (currentUser) {
                    loadProfileData();
                } else {
                    showModal('login');
                    showSection('home');
                }
            } else if (section === 'forum') {
                forumSection.classList.add('active');
            } else if (section === 'adminPanel') {
                adminPanelSection.classList.add('active');
            }
        }

        // Update UI for logged in user
        function updateUIForUser() {
            if (currentUser) {
                loadProfileData();
                
                // Update role badge
                updateRoleBadge();
                
                // Update navigation
                document.querySelector('.nav-actions').innerHTML = `
                    <button class="btn btn-outline btn-small" id="profileNavBtn">
                        <i class="fas fa-user"></i> Profile
                    </button>
                    <button class="btn btn-primary btn-small" id="forumNavBtn">
                        <i class="fas fa-comments"></i> Forum
                    </button>
                    ${currentUser.role === 'admin' ? 
                        `<button class="btn btn-admin btn-small" id="adminNavBtn">
                            <i class="fas fa-crown"></i> Admin
                        </button>` : ''
                    }
                    <button class="btn btn-outline btn-small" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                `;
                
                // Show/hide admin panel link
                if (currentUser.role === 'admin') {
                    adminPanelLink.style.display = 'block';
                } else {
                    adminPanelLink.style.display = 'none';
                }
                
                // Add new button listeners
                document.getElementById('profileNavBtn').addEventListener('click', () => {
                    showSection('profile');
                    updateNavActive('profile');
                });
                document.getElementById('forumNavBtn').addEventListener('click', () => {
                    showSection('forum');
                    updateNavActive('forum');
                });
                if (currentUser.role === 'admin') {
                    document.getElementById('adminNavBtn').addEventListener('click', () => {
                        showSection('adminPanel');
                        loadAdminPanel();
                        updateNavActive(null);
                    });
                }
                document.getElementById('logoutBtn').addEventListener('click', logout);
            }
        }

        function updateRoleBadge() {
            if (!currentUser) return;
            
            roleBadge.className = 'role-badge';
            roleBadge.innerHTML = '';
            
            if (currentUser.role === 'admin') {
                roleBadge.className = 'role-badge role-admin';
                roleBadge.innerHTML = '<i class="fas fa-crown"></i> Administrator';
            } else if (currentUser.role === 'moderator') {
                roleBadge.className = 'role-badge role-moderator';
                roleBadge.innerHTML = '<i class="fas fa-shield-alt"></i> Moderator';
            } else {
                roleBadge.className = 'role-badge role-user';
                roleBadge.innerHTML = '<i class="fas fa-user"></i> User';
            }
        }

        function loadProfileData() {
            nicknameInput.value = currentUser.nickname || currentUser.username;
            userBio.value = currentUser.bio || '';
            usernameDisplay.textContent = `@${currentUser.username}`;
            permanentUsername.value = `@${currentUser.username}`;
            displayName.textContent = currentUser.nickname || currentUser.username;
            userEmail.textContent = currentUser.email;
            avatarImg.src = currentUser.avatar;
            
            const joinDateObj = new Date(currentUser.joinDate);
            joinDate.textContent = joinDateObj.toLocaleDateString('en-US', { 
                month: 'long', 
                year: 'numeric' 
            });
            
            // Clear password fields
            currentPassword.value = '';
            newPassword.value = '';
            confirmNewPassword.value = '';
            currentPasswordForEmail.value = '';
            newEmail.value = '';
            confirmNewEmail.value = '';
            
            // Reset password strength indicator
            strengthBar.className = 'strength-bar';
            reqLength.className = 'invalid';
            reqUppercase.className = 'invalid';
            reqLowercase.className = 'invalid';
            reqNumber.className = 'invalid';
        }

        function updateNavActive(section) {
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === section) {
                    link.classList.add('active');
                }
            });
        }

        function logout() {
            // Reset anti-spam
            antiSpam.lastMessageTime = 0;
            antiSpam.messageCount = 0;
            antiSpam.resetTime = Date.now();
            
            currentUser = null;
            localStorage.removeItem('fandrot_currentUser');
            
            // Reset navigation
            document.querySelector('.nav-actions').innerHTML = `
                <button class="btn btn-outline btn-small" id="loginBtn">
                    <i class="fas fa-sign-in-alt"></i> Log in
                </button>
                <button class="btn btn-primary btn-small" id="registerBtn">
                    <i class="fas fa-user-plus"></i> Sign Up
                </button>
            `;
            
            // Hide admin panel link
            adminPanelLink.style.display = 'none';
            
            // Reattach listeners
            document.getElementById('loginBtn').addEventListener('click', () => showModal('login'));
            document.getElementById('registerBtn').addEventListener('click', () => showModal('register'));
            
            showSection('home');
            updateNavActive('home');
            showNotification('Logged out', 'You have been securely logged out');
        }

        // Load messages with admin/moderator controls
        function loadMessages(tab = 'general') {
            const filteredMessages = messages.filter(msg => msg.tab === tab && !msg.deleted);
            messagesContainer.innerHTML = '';
            
            if (filteredMessages.length === 0) {
                messagesContainer.innerHTML = `
                    <div style="text-align: center; color: var(--gray); padding: 60px 20px;">
                        <i class="fas fa-comment-slash" style="font-size: 60px; margin-bottom: 20px; color: var(--primary); opacity: 0.5;"></i>
                        <h3 style="color: var(--primary); margin-bottom: 10px; font-family: 'Montserrat', sans-serif;">No messages yet</h3>
                        <p>Be the first to start a conversation in this channel</p>
                    </div>
                `;
            } else {
                filteredMessages.forEach(message => addMessageToUI(message));
            }
            
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        function addMessageToUI(message) {
            const messageEl = document.createElement('div');
            messageEl.className = 'message';
            messageEl.dataset.messageId = message.id;
            
            if (message.deleted) {
                messageEl.classList.add('deleted');
            }
            
            let attachmentsHTML = '';
            if (message.attachments && message.attachments.length > 0) {
                attachmentsHTML = `
                    <div class="message-attachments">
                        ${message.attachments.map(att => `
                            <div class="attachment" onclick="openAttachment('${att.url}', '${att.name}')">
                                <i class="fas ${getFileIcon(att.type)}"></i>
                                <span>${att.name} (${att.size})</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            const time = new Date(message.timestamp).toLocaleTimeString([], { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            const date = new Date(message.timestamp).toLocaleDateString();
            
            // Check if current user can delete this message
            const canDelete = currentUser && 
                (currentUser.role === 'admin' || 
                 currentUser.role === 'moderator' || 
                 currentUser.id === message.userId);
            
            const deleteButton = canDelete ? `
                <div class="message-actions">
                    <button class="btn btn-danger btn-very-small delete-message-btn" data-message-id="${message.id}">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            ` : '';
            
            const deletedLabel = message.deleted ? `
                <div class="deleted-label">
                    <i class="fas fa-trash"></i> Deleted by ${message.deletedBy}
                </div>
            ` : '';
            
            messageEl.innerHTML = `
                <img src="${message.avatar}" alt="Avatar" class="message-avatar">
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-sender">${message.nickname || message.username}</span>
                        <span class="message-time">${date} ${time}</span>
                    </div>
                    <div class="message-text">${message.text || ''}</div>
                    ${attachmentsHTML}
                </div>
                ${deletedLabel}
                ${deleteButton}
            `;
            
            messagesContainer.appendChild(messageEl);
            
            // Add delete button listener
            if (canDelete) {
                const deleteBtn = messageEl.querySelector('.delete-message-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDeleteModal(message);
                });
            }
        }

        // Show delete confirmation modal
        function showDeleteModal(message) {
            messageToDelete = message;
            deleteMessageContent.innerHTML = `
                <div style="margin-bottom: 10px;">
                    <strong>From:</strong> ${message.nickname || message.username}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Time:</strong> ${new Date(message.timestamp).toLocaleString()}
                </div>
                <div style="margin-bottom: 10px;">
                    <strong>Message:</strong> ${message.text || '(No text)'}
                </div>
                ${message.attachments && message.attachments.length > 0 ? 
                    `<div><strong>Attachments:</strong> ${message.attachments.length} file(s)</div>` : ''
                }
            `;
            showModal('delete');
        }

        // Handle message deletion
        function handleDeleteMessage() {
            if (!messageToDelete || !currentUser) return;
            
            // Mark message as deleted
            const messageIndex = messages.findIndex(m => m.id === messageToDelete.id);
            if (messageIndex !== -1) {
                messages[messageIndex].deleted = true;
                messages[messageIndex].deletedBy = currentUser.nickname || currentUser.username;
                messages[messageIndex].deletedAt = new Date().toISOString();
                
                // Add to deleted messages archive
                deletedMessages.push(messages[messageIndex]);
                
                localStorage.setItem('fandrot_messages', JSON.stringify(messages));
                localStorage.setItem('fandrot_deleted_messages', JSON.stringify(deletedMessages));
                
                // Reload current tab messages
                const currentTab = document.querySelector('.tab.active').dataset.tab;
                loadMessages(currentTab);
                
                // Update admin panel if open
                if (adminPanelSection.classList.contains('active')) {
                    loadDeletedMessages();
                    updateAdminStats();
                }
                
                hideModal('delete');
                showNotification('Message deleted', 'The message has been removed from the forum');
            }
        }

        // Load admin panel
        function loadAdminPanel() {
            if (!currentUser || currentUser.role !== 'admin') {
                showSection('forum');
                return;
            }
            
            updateAdminStats();
            loadUsersList();
            loadDeletedMessages();
        }

        function updateAdminStats() {
            totalUsers.textContent = users.length;
            totalMessages.textContent = messages.length;
            adminCount.textContent = users.filter(u => u.role === 'admin').length;
            moderatorCount.textContent = users.filter(u => u.role === 'moderator').length;
        }

        function loadUsersList() {
            usersList.innerHTML = '';
            
            users.forEach(user => {
                const userCard = document.createElement('div');
                userCard.className = 'user-card';
                
                let roleBadgeClass = 'role-user';
                let roleIcon = 'fa-user';
                if (user.role === 'admin') {
                    roleBadgeClass = 'role-admin';
                    roleIcon = 'fa-crown';
                } else if (user.role === 'moderator') {
                    roleBadgeClass = 'role-moderator';
                    roleIcon = 'fa-shield-alt';
                }
                
                const roleOptions = `
                    <option value="user" ${user.role === 'user' ? 'selected' : ''}>User</option>
                    <option value="moderator" ${user.role === 'moderator' ? 'selected' : ''}>Moderator</option>
                    <option value="admin" ${user.role === 'admin' ? 'selected' : ''}>Administrator</option>
                `;
                
                userCard.innerHTML = `
                    <div class="user-header">
                        <img src="${user.avatar}" alt="Avatar" class="user-avatar">
                        <div class="user-info">
                            <h4>${user.nickname || user.username}</h4>
                            <p>@${user.username}</p>
                            <div class="role-badge ${roleBadgeClass}" style="margin-top: 5px;">
                                <i class="fas ${roleIcon}"></i> ${user.role}
                            </div>
                        </div>
                    </div>
                    <div class="user-details">
                        <p style="color: var(--gray); font-size: 13px; margin-bottom: 10px;">
                            <i class="fas fa-envelope"></i> ${user.email}<br>
                            <i class="fas fa-calendar"></i> Joined ${new Date(user.joinDate).toLocaleDateString()}
                        </p>
                        ${currentUser.id !== user.id ? `
                            <select class="role-select" data-user-id="${user.id}">
                                ${roleOptions}
                            </select>
                            <div class="user-actions">
                                <button class="btn btn-danger btn-small delete-user-btn" data-user-id="${user.id}" ${user.role === 'admin' ? 'disabled' : ''}>
                                    <i class="fas fa-trash"></i> Delete User
                                </button>
                            </div>
                        ` : '<p style="color: var(--gray); font-size: 12px;">This is your account</p>'}
                    </div>
                `;
                
                usersList.appendChild(userCard);
                
                // Add role change listener
                if (currentUser.id !== user.id) {
                    const roleSelect = userCard.querySelector('.role-select');
                    roleSelect.addEventListener('change', (e) => {
                        updateUserRole(user.id, e.target.value);
                    });
                    
                    // Add delete user listener
                    const deleteBtn = userCard.querySelector('.delete-user-btn');
                    deleteBtn.addEventListener('click', () => {
                        if (confirm(`Are you sure you want to delete user ${user.username}?`)) {
                            deleteUser(user.id);
                        }
                    });
                }
            });
        }

        function updateUserRole(userId, newRole) {
            const userIndex = users.findIndex(u => u.id === userId);
            if (userIndex === -1) return;
            
            // Prevent demoting yourself from admin
            if (userId === currentUser.id && newRole !== 'admin') {
                showNotification('Role Change Failed', 'You cannot change your own role from admin', 'error');
                loadUsersList();
                return;
            }
            
            users[userIndex].role = newRole;
            
            // Update permissions based on role
            if (newRole === 'admin') {
                users[userIndex].permissions = ['delete_messages', 'manage_users', 'assign_roles', 'view_admin_panel'];
            } else if (newRole === 'moderator') {
                users[userIndex].permissions = ['delete_messages'];
            } else {
                users[userIndex].permissions = [];
            }
            
            localStorage.setItem('fandrot_users', JSON.stringify(users));
            
            // If the updated user is the current user, update the UI
            if (userId === currentUser.id) {
                currentUser = users[userIndex];
                localStorage.setItem('fandrot_currentUser', JSON.stringify(currentUser));
                updateUIForUser();
            }
            
            updateAdminStats();
            showNotification('Role Updated', `${users[userIndex].username} is now a ${newRole}`);
        }

        function deleteUser(userId) {
            if (userId === currentUser.id) {
                showNotification('Delete Failed', 'You cannot delete your own account', 'error');
                return;
            }
            
            const userIndex = users.findIndex(u => u.id === userId);
            if (userIndex === -1) return;
            
            const username = users[userIndex].username;
            users.splice(userIndex, 1);
            localStorage.setItem('fandrot_users', JSON.stringify(users));
            
            updateAdminStats();
            loadUsersList();
            showNotification('User Deleted', `${username} has been removed from the system`);
        }

        function loadDeletedMessages() {
            deletedMessagesContainer.innerHTML = '';
            
            if (deletedMessages.length === 0) {
                deletedMessagesContainer.innerHTML = `
                    <div style="text-align: center; color: var(--gray); padding: 40px 20px;">
                        <i class="fas fa-trash-restore" style="font-size: 40px; margin-bottom: 15px; color: var(--danger); opacity: 0.5;"></i>
                        <h4 style="color: var(--danger); margin-bottom: 10px;">No deleted messages</h4>
                        <p>Deleted messages will appear here</p>
                    </div>
                `;
                return;
            }
            
            deletedMessages.forEach(msg => {
                const msgEl = document.createElement('div');
                msgEl.className = 'message deleted';
                
                const time = new Date(msg.timestamp).toLocaleTimeString([], { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                const date = new Date(msg.timestamp).toLocaleDateString();
                
                msgEl.innerHTML = `
                    <img src="${msg.avatar}" alt="Avatar" class="message-avatar">
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-sender">${msg.nickname || msg.username}</span>
                            <span class="message-time">${date} ${time}</span>
                        </div>
                        <div class="message-text">${msg.text || ''}</div>
                        <div style="margin-top: 10px; font-size: 12px; color: var(--danger);">
                            <i class="fas fa-trash"></i> Deleted by ${msg.deletedBy} on ${new Date(msg.deletedAt).toLocaleString()}
                        </div>
                    </div>
                `;
                
                deletedMessagesContainer.appendChild(msgEl);
            });
        }

        function addSampleMessages() {
            const sampleMessages = [
                {
                    id: generateId(),
                    userId: 'admin_1',
                    username: 'admin',
                    nickname: 'System Administrator',
                    avatar: 'https://ui-avatars.com/api/?name=Admin&background=9d4edd&color=ffffff&size=150&bold=true',
                    text: 'Welcome to the FanDrot community forum! This is a secure, encrypted space for discussions. Remember to follow community guidelines.',
                    timestamp: new Date(Date.now() - 3600000).toISOString(),
                    tab: 'general',
                    deleted: false
                },
                {
                    id: generateId(),
                    userId: 'moderator_1',
                    username: 'moderator',
                    nickname: 'Community Moderator',
                    avatar: 'https://ui-avatars.com/api/?name=Moderator&background=4cc9f0&color=ffffff&size=150&bold=true',
                    text: 'As a moderator, I\'m here to help maintain a positive and respectful environment. Please report any issues!',
                    timestamp: new Date(Date.now() - 1800000).toISOString(),
                    tab: 'general',
                    deleted: false
                },
                {
                    id: generateId(),
                    userId: generateId(),
                    username: 'new_user',
                    nickname: 'New Member',
                    avatar: 'https://ui-avatars.com/api/?name=New+User&background=0099ff&color=ffffff&size=150&bold=true',
                    text: 'Just joined! Excited to be part of this community. The encryption features look amazing!',
                    attachments: [{name: 'welcome.jpg', type: 'image/jpeg', size: '1.2 MB', url: 'https://images.unsplash.com/photo-1550745165-9bc0b252726f?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80'}],
                    timestamp: new Date(Date.now() - 900000).toISOString(),
                    tab: 'general',
                    deleted: false
                }
            ];
            
            messages.push(...sampleMessages);
            localStorage.setItem('fandrot_messages', JSON.stringify(messages));
        }

        function updateUsersStorage() {
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
                localStorage.setItem('fandrot_users', JSON.stringify(users));
            }
        }

        function showNotification(title, message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.style.borderLeftColor = type === 'error' ? 'var(--accent)' : 'var(--primary)';
            
            const icon = type === 'error' ? 'fa-exclamation-circle' : 'fa-check-circle';
            
            notification.innerHTML = `
                <i class="fas ${icon} notification-icon"></i>
                <div class="notification-content">
                    <h4>${title}</h4>
                    <p>${message}</p>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }

        function openAttachment(url, name) {
            window.open(url, '_blank');
        }

        function getFileIcon(type) {
            if (type.startsWith('image/')) return 'fa-image';
            if (type.startsWith('video/')) return 'fa-video';
            if (type.includes('pdf')) return 'fa-file-pdf';
            if (type.includes('zip') || type.includes('compressed')) return 'fa-file-archive';
            if (type.includes('text') || type.includes('code')) return 'fa-file-code';
            return 'fa-file';
        }

        function formatFileSize(bytes) {
            if (bytes < 1024) return bytes + ' Bytes';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function generateId() {
            return 'id_' + Date.now().toString(36) + Math.random().toString(36).substr(2, 9);
        }

        // Make functions available globally
        window.openAttachment = openAttachment;
    </script>
</body>
</html>